(function(win,doc){
    'use strict';

    let defaultUrl;
    let statusDemand;
    let countGroupDemand=0;

    win.defaultValues = (function()
    {
        return {
            defaultValues: function (pUrl, pStatusDemand){
                defaultUrl      = pUrl;
                statusDemand    = pStatusDemand;
            }
        }
    })();

    win.changeStatusDemand = (function()
    {
        return {
            changeStatusDemand: function (pUrl, pDemands, pStatus, pOldStatus){
                let i, msgResponse='', boolResponse=false;
                $.ajax({
                    url: pUrl,
                    type: "post",
                    headers: {
                        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                    },
                    data : {
                        demands : pDemands,
                        status_type : pStatus,
                        old_status_type : pOldStatus
                    },
                    dataType: "json",
                    success : function (response) {
                        for (i=0; i < response.length; i++) {
                            if(response[i].success === true){
                                boolResponse = response[i].success;
                            }
                            if(i == 0){
                                msgResponse = msgResponse+response[i].message;
                            } else {
                                msgResponse = msgResponse+'\n'+response[i].message;
                            }
                        }
                        if(boolResponse){
                            alert(msgResponse);
                            win.location.reload();
                        } else {
                            alert(msgResponse);
                        }
                    }
                });
            }
        }
    })();

    $(doc).on('click','.btn-cancel-demand-modal', function () {
        var idDemand = $(this).data("demandid");
        $('#idconfirmCancelDemandModal').modal('show');
        $('#idSpanCancelDemandModal').text(idDemand);
        $('#idCancelDemandModal').val(idDemand);
    });

    $(doc).on('click','.icheck-group-demand', function () {
        if($(this).is(':checked')){
            countGroupDemand++;
        } else {
            countGroupDemand--;
        }
        if(countGroupDemand>1){
            $('#idBtnGroupPrint').prop("disabled", false);
            $('#idBtnGroupPrint').removeClass('disabled');
            $('#idBtnGroupAtend').prop("disabled", false);
            $('#idBtnGroupAtend').removeClass('disabled');
        } else {
            $('#idBtnGroupPrint').prop("disabled", true);
            $('#idBtnGroupPrint').addClass('disabled');
            $('#idBtnGroupAtend').prop("disabled", true);
            $('#idBtnGroupAtend').addClass('disabled');
        }
    });

    $(doc).on('click','#idBtnGroupPrint', function () {
        let demandsGroupImp = [];
        $('.icheck-group-demand').each(function() {
            if($(this).is(':checked')) {
                demandsGroupImp.push($(this).data("demandid"));
            }
        });
        win.open(defaultUrl+'print/'+demandsGroupImp, '_blank', '');
    });

    $(doc).on('click','#idBtnGroupAtend', function () {
        let demandsGroupAtend = [];
        $('.icheck-group-demand').each(function() {
            if($(this).is(':checked')) {
                demandsGroupAtend.push({ "demand_id":  $(this).data("demandid") });
            }
        });
        changeStatusDemand.changeStatusDemand(defaultUrl+'changestatus', demandsGroupAtend, statusDemand+1, statusDemand);
    });

})(window, document);
